
resource "azurerm_container_app" "unstructured_api" {
  name                          = "unstructured-api"
  container_app_environment_id  = azurerm_container_app_environment.dify-aca-env.id
  resource_group_name           = azurerm_resource_group.rg.name
  revision_mode                 = "Single"

  template {
    tcp_scale_rule {
      name                = "unstructured-api"
      concurrent_requests = "10"
    }
    max_replicas = 10
    min_replicas = 1
    container {
      name   = "unstructured-api"
      image  = "downloads.unstructured.io/unstructured-io/unstructured-api:latest"
      cpu    = 2
      memory = "4Gi"

      
    }
  }

  ingress {
    target_port      = 8000
    external_enabled = false
    traffic_weight {
      # weight             = 100
      latest_revision    = true
      percentage         = 100
    }
    transport = "auto"
  }
}
